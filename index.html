<!DOCTYPE html>
<html lang="be">
<head>
  <meta charset="UTF-8" />
  <title>Магічны шар</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #111;
    }
    #canvas {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
    }
    #window-mask {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 2;
      pointer-events: none;
      border-radius: 50%;
      overflow: hidden;
    }
    #triangle-svg {
      display: block;
      margin: auto;
      pointer-events: auto;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>
  <div id="window-mask">
    <svg id="triangle-svg" viewBox="-1 -1 2 2" preserveAspectRatio="xMidYMid meet">
      <polygon id="inner-triangle"
               points="0,-0.9 0.78,0.45 -0.78,0.45"
               fill="#1770d8"/>
      <text id="answer-text"
            x="0"
            y="-0.1"
            text-anchor="middle"
            fill="white"
            font-weight="bold"
            dominant-baseline="middle">
      </text>
    </svg>
  </div>
  <script>
    const answers = [
      "Бясспрэчна", "Прадвырашана", "Ніякіх сумневаў", "Вызначана так", "Можаш спадзявацца",
      "Як я бачу – так", "Верагодней за ўсё", "Добрыя перспектывы", "Знакі кажуць - так", "Так",
      "Пакуль не ясна, паспрабуй зноў", "Спытай пазней", "Лепей не цяпер", "Цяпер нельга прадказаць",
      "Сканцэнтруйся і спытай зноў", "Нават не думай", "Мой адказ - не", "Па маіх дадзеных - не",
      "Перспектывы - ня вельмі", "Вельмі сумнеўна", "Тужык тут быў"
    ];
    const answerElem = document.querySelector("#answer-text");

    // Функцыя для разбіцця тэксту на радкі з пераносам
    function wrapTextInTriangle(text, maxWidthChars) {
      const words = text.split(' ');
      const lines = [];
      let currentLine = '';

      for (let word of words) {
        if ((currentLine + ' ' + word).length <= maxWidthChars || currentLine === '') {
          currentLine = currentLine ? currentLine + ' ' + word : word;
        } else {
          lines.push(currentLine);
          currentLine = word;
        }
      }
      if (currentLine) {
        lines.push(currentLine);
      }

      return lines;
    }

    // Функцыя для стварэння шматрадковага тэксту ў SVG
    function createMultilineText(lines, lineHeight) {
      // Чысцім папярэдні тэкст
      while (answerElem.firstChild) {
        answerElem.removeChild(answerElem.firstChild);
      }

      // Ствараем tspan для кожнага радка
      lines.forEach((line, index) => {
        const tspan = document.createElementNS('http://www.w3.org/2000/svg', 'tspan');
        tspan.textContent = line;
        tspan.setAttribute('x', '0');
        tspan.setAttribute('dy', index === 0 ? '0' : lineHeight);
        answerElem.appendChild(tspan);
      });
    }

    // Функцыя для падбору аптымальнага памеру шрыфта
    function fitTextInTriangle(text) {
      const maxWidthChars = 12; // Максімальная колькасць літар у радку
      const lines = wrapTextInTriangle(text, maxWidthChars);
      const maxLines = 3; // Максімальная колькасць радкоў
      
      // Калі радкоў больш максімальнага, аб'ядноўваем апошнія радкі
      if (lines.length > maxLines) {
        const lastLine = lines.slice(maxLines - 1).join(' ');
        lines.splice(maxLines - 1, lines.length, lastLine);
      }

      let fontSize = 0.12; // Пачатковы памер шрыфта
      const lineHeight = '1.1em'; // Вышыня радка

      createMultilineText(lines, lineHeight);
      answerElem.setAttribute("font-size", fontSize);

      return fontSize;
    }

    document.getElementById("triangle-svg").addEventListener("click", () => {
      answerElem.style.opacity = 0;
      setTimeout(() => {
        const random = answers[Math.floor(Math.random() * answers.length)];
        
        const fontSize = fitTextInTriangle(random);
        answerElem.setAttribute("font-size", fontSize);
        answerElem.style.opacity = 1;
      }, 250);
    });

    window.onload = function () {
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      const minSide = Math.min(canvas.width, canvas.height);
      const radius = (minSide * 0.75) / 2;
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const hatchRadius = radius * Math.sqrt(0.35);
      const innerWindowRadius = hatchRadius * 0.85;
      const mask = document.getElementById("window-mask");
      const svg = document.getElementById("triangle-svg");
      const svgSize = innerWindowRadius * 2;
      mask.style.width = svgSize + "px";
      mask.style.height = svgSize + "px";
      svg.setAttribute("width", svgSize);
      svg.setAttribute("height", svgSize);

      // Фон
      ctx.fillStyle = "#222";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Градыент шару
      const gradient = ctx.createRadialGradient(
        centerX - radius * 0.3,
        centerY - radius * 0.3,
        radius * 0.1,
        centerX,
        centerY,
        radius
      );
      gradient.addColorStop(0, '#444');
      gradient.addColorStop(1, '#000');
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
      ctx.fillStyle = gradient;
      ctx.fill();

      // Цень
      ctx.save();
      ctx.shadowBlur = 20;
      ctx.shadowColor = "rgba(0, 0, 0, 0.6)";
      ctx.beginPath();
      ctx.arc(centerX, centerY + radius * 0.3, radius * 0.9, 0, Math.PI * 2);
      ctx.fillStyle = "rgba(0, 0, 0, 0.2)";
      ctx.fill();
      ctx.restore();

      // Люк
      const hatchGradient = ctx.createRadialGradient(
        centerX - hatchRadius * 0.3,
        centerY - hatchRadius * 0.3,
        hatchRadius * 0.1,
        centerX,
        centerY,
        hatchRadius
      );
      hatchGradient.addColorStop(0, '#e0e0e0');
      hatchGradient.addColorStop(1, '#999');
      ctx.beginPath();
      ctx.arc(centerX, centerY, hatchRadius, 0, Math.PI * 2);
      ctx.fillStyle = hatchGradient;
      ctx.fill();
      ctx.beginPath();
      ctx.arc(centerX, centerY, hatchRadius, 0, Math.PI * 2);
      ctx.strokeStyle = '#666';
      ctx.lineWidth = 2;
      ctx.stroke();

      // Празрыстае акно
      ctx.save();
      ctx.globalCompositeOperation = 'destination-out';
      ctx.beginPath();
      ctx.arc(centerX, centerY, innerWindowRadius, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();

      // Блакітнае шкло
      ctx.beginPath();
      ctx.arc(centerX, centerY, innerWindowRadius, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(0, 200, 255, 0.1)';
      ctx.fill();

      // Усталёўваем пачатковы тэкст
      fitTextInTriangle("Націсні на шар");
    };

    window.onresize = function () {
      location.reload();
    };
  </script>
</body>
</html>